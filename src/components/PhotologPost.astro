---
import { type CollectionEntry } from "astro:content";

type Props = {
  post: CollectionEntry<"photolog">;
};

const { post } = Astro.props;
const fmt = (d: Date) => d.toISOString().slice(0, 10);

const imageUrls = Array.from(post.body.matchAll(/!\[[^\]]*]\(([^)]+)\)/g))
  .map((match) => match[1])
  .slice(0, 3);
---

<article>
  <div class="flex flex-col md:flex-row md:items-start">
    <span class="max-w-max mr-0 mb-2 md:mb-0 md:mr-4 px-2 py-1 rounded-md bg-[#24093F] text-violet-300 text-xs">
      {fmt(post.data.date)}
    </span>

    <a
      href={`/photolog/${post.slug}`}
      class="text-base post-list-title text-slate-100 inline-block"
    >
      <div class="flex flex-col">
        <h2>{post.data.title}</h2>
        {imageUrls.length > 0 && (
          <div class="mt-3 grid grid-cols-3 gap-2 md:flex md:flex-row md:flex-wrap">
            {imageUrls.map((src) => (
              <div class="w-full aspect-square rounded-md overflow-hidden md:h-20 md:w-20 md:aspect-auto">
                <img
                  src={src}
                  alt=""
                  loading="lazy"
                  class="h-full w-full object-cover scale-[1.2]"
                />
              </div>
            ))}
          </div>
        )}
      </div>
    </a>
  </div>
</article>
