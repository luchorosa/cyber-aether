---
import { getCollection, type CollectionEntry } from "astro:content";
import Main from "../components/Main.astro";
import Layout from "../layouts/Layout.astro";
import Post from "../components/Post.astro";
import PhotologPost from "../components/PhotologPost.astro";

const posts = await getCollection("posts", ({ data }) => !data.draft);
const photos = await getCollection("photolog", ({ data }) => !data.draft);

type FeedItem =
	| { type: "post"; entry: CollectionEntry<"posts"> }
	| { type: "photolog"; entry: CollectionEntry<"photolog"> };

const items: FeedItem[] = [
	...posts.map((entry) => ({ type: "post", entry })),
	...photos.map((entry) => ({ type: "photolog", entry })),
].sort((a, b) => b.entry.data.date.valueOf() - a.entry.data.date.valueOf());
---

<Layout title="Home" activeTab="all">
	<Main>
		<div class="grid grid-cols-1 gap-x-16 gap-y-8 max-md:grid-cols-1 mg-24">
			{items.map((item) =>
				item.type === "post" ? (
					<Post post={item.entry} />
				) : (
					<PhotologPost post={item.entry} />
				),
			)}
		</div>
	</Main>
</Layout>
